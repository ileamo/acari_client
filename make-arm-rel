#! /usr/bin/env sh
rm -r _build/prod

make -C deps/procket/c_src clean
export CROSSCOMPILE=1
export ERLANG_ARCH=32
export CC=/opt/nsgdevkit-2017-Q2/usr/bin/arm-nsg_rt-linux-gnueabi-gcc
export AR=/opt/nsgdevkit-2017-Q2/usr/bin/arm-nsg_rt-linux-gnueabi-ar
export RANLIB=/opt/nsgdevkit-2017-Q2/usr/bin/arm-nsg_rt-linux-gnueabi-ranlib
export ERTS_INCLUDE_DIR=/opt/elixir-kit/erlang/erts-10.0.2/include
export ERL_INTERFACE_INCLUDE_DIR=/opt/elixir-kit/erlang/lib/erl_interface-3.10.3/include
export ERL_INTERFACE_LIB_DIR=/opt/elixir-kit/erlang/lib/erl_interface-3.10.3/lib
mix deps.get --only prod
MIX_ENV=prod mix release --env=prod
cd _build/prod/rel/
rm acari_client/releases/0.1.0/acari_client.tar.gz
tar -czf acari_client.tar.gz acari_client

#To Client
scp acari_client.tar.gz root@10.0.10.69:/usr/lib
ssh root@10.0.10.69 "tar -C /usr/lib -mxzf /usr/lib/acari_client.tar.gz"
